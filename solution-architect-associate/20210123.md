

整合性モデル

- 結果整合性　データ変更中に他がデータを参照可。古いデータを返すr
- 強い整合性　データ参照中に不整合が発生しない

データモデル

- リレーショナルモデル
- グラフモデル
- キーバリューストア
- オブジェクト
- ドキュメント
- ワイドカラム
- 階層型

データベース

- リレーショナルDB　データとデータの関係が定義された　ER図
- NoSQL　非構造化（音声、動画）、半構造化（JSON）を利用する。ビックデータ向け？

NoSQL

- キーバリューストア
- ワイドカラムストア
- グラフデータベース
- ドキュメントデータベース

**DWH　データウェアハウス　RedShift**

BI分析用のことが多い。構造が決まってることが多い。列志向でデータを格納

**分散型DB・データレイク　S3**

ビックデータやIOTデータを蓄積して高速処理を可能にするDBとストレージの組み合わせ

**キーバリュー型　ElastiCache　DynamoDB**

シンプルなデータ構造にすることで高速処理を可能にしたDB。キーに応じてデータを分散して高速データ処理が可能になっている。

**ワイドカラム型　DynamoDB**

結果整合性を採用。キーとカラムが入れ子構造KeyX=>ColumnY=>RowZ。可能な限り多くのデータを同じ行に保持

**ドキュメントDB　Amazon DocumentDB**

ドキュメント構造を一緒に保存できる。シャーディングを使って高速にデータを処理する

**インメモリデータグリッド　Redis ElastiCache Memcached ElastiCache**

KVSの仕組みをメモリを利用してより高性能にしたDB。金融など。

**全検索型エンジン＊分散DB　Elasticserach Service**

分散データベースと連携してデータ前検索処理が可能

**グラフDB Amazon Neptune**

スケールアウトできない。ACID特性が担保されている。最短経路探索、金融取引の詐欺検出など。

**分散OLTP（RDB） Amazon Aurora**

分散型でもRDBを構築する次世代DB。クラウド前提

### DynamoDB

- ワイドカラム型。Join/Transaction/Commit/Rollbackが不可。大量のデータ読み書きにコストがかかる。
- デフォルトが結果整合性。強い整合性をGetItem/Query/Scanで強い整合性の指定可。
- パーティショニングを行って分散処理を実現している
- ログ系データの蓄積に向く
- グローバルテーブル　強い整合性は負荷になる。
- オンデマンドバックアップ　パフォーマンスを悪化させること無く、長期間保存できるバックアップを作成できる。

設計項目

- テーブル（データベースを作りましょうではなくテーブルを）
- 項目（アイテム）　Person
- 属性　最小の単位 SurName

インデックス

暗黙的なキー（ハッシュキー、レンジキー）と明示的なキー（ローカルセカンダリーインデックスLSI）がある。全データに対してグローバルに付与。１つのテーブルに５つ作成可能・テーブル作成後に作成

- ハッシュキー（KVSにおけるキー）。単独重複不可。
- レンジキー　ハッシュキーと合わせ複合キーと呼ぶ。複合キーは単独では重複を許される。
- LSI　レンジキーで絞り込み検索を行うためのインデックス。
- GSI ハッシュキーの属性の代わりになる。ハッシュキーをまたいで自由に検索ができるようにする

**DynamoDB Streams**

テーブルで保存された追加変更削除のログをとる。２４時間保存し、その後消去される。ハッシュキーがことなる場合ログの順番が前後する可能性がある。

- クロスリージョンレプリケーションが可能になる。
- データ更新をトリガーとしたアプリケーション処理

**DynamoDB Accelerator (DAX)**

インメモリにキャッシュを作り超高速になる。結果整合性のある読み込みワークロードの応答時間を軽減。

Read/Write キャパシティオンデマンド
トラフィック量が予測が不可能の時に便利。自動的にスケーリングしてくれる。変更は１日１回まで。

### Aurora

NoSQL型の分散処理のパフォーマンスをRDBとして利用できるように

- MySQL5.6互換、PostgreSQL互換を選択可能
- エンドポイントを利用して書き込みにはAurora Writerを読み取りにはAurora Readerを利用することができる。書が維持にはフェイルオーバーしてリードレプリカが昇格する
- MySQLはスナップショットをとることで、Auroraにマイグレーションできる。

**耐障害性/自己回復性**

- ３つのAZに２つのコピーを設置可能で合計６つのコピーを保持。これらは仮想ボリュームとしてAZを跨いで単一クラスタと認識される。
- 過去のデータがそのままS3に継続的にバックアップ
- リストアも差分適用がなく高速。度のタイミングでも安定したリストア時間を実現
- 99.99%の高可用性・高耐久性

**スケーラビリティ**

- 10GBがら64TBまで提供するSSDデータプレーンを利用してシームレスに拡張可能
- Auto-Scaling可
- 最大１５個のリードレプリカを利用した高速読み込みが可能

**Auroraマルチマスター**

- Writerもマルチマスター構成ができるように＝どのノードが落ちても、どのAZが落ちてもダウンタイムがゼロに。

**Auroraサーバレス**

オンデマンドで自動スケールングと自動的に起動とシャットダウンを行ってくれる

**AuroraグローバルDB**

他リージョンに対する高性能なリードレプリカ作成機能。ログ転送ではなくストレージレベルのレプリケーションになる。概ね１秒、最大５秒の低レーテンシー

### EFS

- フルマネージド型
- ネットワークファイルシステムバージョン４（NFSv4）
- 何千もの同時アクセスが実現可能という性能が特徴的
- 基本性能は１００MB（バースト込み）
- ファイル名は255バイト
- 1ファイルの最大容量48TB
- インスタンスあたり128ユーザーまでの同時オープンが可能
- アカウントあたり1000個までファイルシステムを持てる
- AZごとのファイルシステムあたりのマウントターゲットは１
- マウントターゲットあたりのセキュリティグループ５
- ファイルシステムあたりのVPC数１
- 各VPCのマウントターゲットの数４００
- データアクセスに課金なり。データ容量に課金される。

ファイルストレージ

- EFS　NASに似たファイルストレージ
- Amazon FSx For Windows File Server
- Amazon FSx For Lustre オープンソースLusterと互換性のある分散型の高速ストレージ。機械学習など高速コンピューティングのデータレイヤーに利用する


### ビックデータ対応

- Volume　大量データ
- Variety　多様なデータ
- Velocity 早い処理

データレイクは全データを生データのまま保存する。業務システムのデータをETLを通してレポート形式に変換して保存される。

- Apache Hadoop　もともとあった大量データ処理向け
- Apache Spark　ストリーミング処理向け

### Kinesis

- Amazon Kinesis Data Streams　メイン機能。ストリームデータを処理するアプリケーションを構築
- Amazon Kinesis Data Firehose　ストリームデータをS3やRedshiftなどへ簡単に配信
- Amazon Kinesis Data Analytics　ストリームデータを標準的なSQLクエリでリアルタイムに可視化・分析


**Amazon Kinesis Data Streams**

Iotデータをストリーム処理する。シャートに分けて分散して高速処理が可能。

次を使ってデータを送信する。

- Amazon Kinesis Agent　OSSのスタンドアロンJavaアプリケーション
- Amazon Kinesis Producer Library データを送信するOSSの補助ライブラリ
- Fluent Plugin for Amazon Kinesis
- Amazon Kinesis Data Generator テストデータを簡単に送信できる
- Amazon Kinesis Client Library OSSのクライアントライブラリでKinesisアプリケーションを作成する

**Amazon Kinesis Data Firehose**

各種DB（S3,RedShift、ElasticSearch）などに配信、蓄積するストリーム処理を実施する。Lambdaと連携するとETLとしても機能する

**Amazon Kinesis Data Analytics**

ストリームデータを標準的なSQLクエリでリアルタイムに分析
